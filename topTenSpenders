WITH client_sales_table (
    client_id,
    first_name,
    last_name,
    city,
    country,
    amount
) AS (
    SELECT t.client_id,
           c.first_name,
           c.last_name,
           ci.city_name,
           co.country_name,
           t.amount
    FROM transactions t
    INNER JOIN clients c ON t.client_id = c.client_id
    INNER JOIN locations l ON c.location_id = l.location_id
    INNER JOIN cities ci ON l.city_id = ci.city_id
    INNER JOIN countries co ON ci.country_id = co.country_id
)
SELECT DISTINCT client_id,
       first_name,
       last_name,
       city,
       country,
       SUM(amount) AS total_spent
FROM client_sales_table
GROUP BY client_id,
         first_name,
         last_name,
         city,
         country
ORDER BY total_spent DESC
LIMIT 10;
